<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docx2Shelf Web - Document to EPUB Converter</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/themes.css">
    <link rel="icon" href="assets/favicon.ico">

    <!-- Web Worker for background processing -->
    <script src="js/workers/conversion-worker.js" type="module"></script>

    <!-- External libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>

    <!-- AI Integration -->
    <script src="js/ai/chapter-detection.js" type="module"></script>
    <script src="js/ai/web-llm-client.js" type="module"></script>
</head>
<body>
    <div id="app" class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo-section">
                    <img src="assets/logo.svg" alt="Docx2Shelf" class="logo">
                    <h1>Docx2Shelf Web</h1>
                    <span class="version">v1.6.2-web</span>
                </div>
                <div class="header-actions">
                    <button id="settings-btn" class="btn btn-secondary">
                        <i class="icon-settings"></i> Settings
                    </button>
                    <button id="help-btn" class="btn btn-secondary">
                        <i class="icon-help"></i> Help
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- File Input Section -->
            <section class="file-input-section">
                <div class="upload-area" id="upload-area">
                    <div class="upload-content">
                        <i class="icon-upload"></i>
                        <h3>Drop your document here</h3>
                        <p>Supports DOCX, HTML, Markdown, and TXT files</p>
                        <button id="browse-btn" class="btn btn-primary">Browse Files</button>
                        <input type="file" id="file-input" accept=".docx,.html,.htm,.md,.txt" hidden>
                    </div>
                </div>

                <!-- File Info -->
                <div id="file-info" class="file-info hidden">
                    <div class="file-details">
                        <i class="icon-file"></i>
                        <div class="file-meta">
                            <span class="file-name"></span>
                            <span class="file-size"></span>
                            <span class="file-type"></span>
                        </div>
                    </div>
                    <button id="clear-file" class="btn btn-text">
                        <i class="icon-close"></i> Clear
                    </button>
                </div>
            </section>

            <!-- Conversion Settings -->
            <section class="conversion-settings">
                <div class="settings-tabs">
                    <button class="tab-btn active" data-tab="metadata">Metadata</button>
                    <button class="tab-btn" data-tab="conversion">Conversion</button>
                    <button class="tab-btn" data-tab="ai">AI Detection</button>
                    <button class="tab-btn" data-tab="preview">Preview</button>
                </div>

                <!-- Metadata Tab -->
                <div id="metadata-tab" class="tab-content active">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="book-title">Title *</label>
                            <input type="text" id="book-title" required>
                        </div>
                        <div class="form-group">
                            <label for="book-author">Author *</label>
                            <input type="text" id="book-author" required>
                        </div>
                        <div class="form-group">
                            <label for="book-language">Language</label>
                            <select id="book-language">
                                <option value="en">English</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                                <option value="it">Italian</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="book-genre">Genre</label>
                            <input type="text" id="book-genre" placeholder="Fiction, Non-fiction, etc.">
                        </div>
                        <div class="form-group full-width">
                            <label for="book-description">Description</label>
                            <textarea id="book-description" rows="4"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Conversion Tab -->
                <div id="conversion-tab" class="tab-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="css-theme">CSS Theme</label>
                            <select id="css-theme">
                                <option value="serif">Serif</option>
                                <option value="sans">Sans-serif</option>
                                <option value="printlike">Print-like</option>
                                <option value="custom">Custom Theme...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="chapter-detection">Chapter Detection</label>
                            <select id="chapter-detection">
                                <option value="auto">Automatic</option>
                                <option value="h1">H1 Headers</option>
                                <option value="h2">H2 Headers</option>
                                <option value="ai">AI Detection</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="include-toc" checked>
                                Include Table of Contents
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="validate-epub" checked>
                                Validate EPUB Output
                            </label>
                        </div>
                    </div>
                </div>

                <!-- AI Detection Tab -->
                <div id="ai-tab" class="tab-content">
                    <div class="ai-settings">
                        <div class="ai-service-selection">
                            <h4>AI Service</h4>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="ai-service" value="web-llm" checked>
                                    Web LLM (Browser-based)
                                </label>
                                <label>
                                    <input type="radio" name="ai-service" value="api">
                                    Cloud API (OpenAI, Anthropic)
                                </label>
                                <label>
                                    <input type="radio" name="ai-service" value="free">
                                    Free Service (Limited)
                                </label>
                            </div>
                        </div>

                        <!-- Web LLM Settings -->
                        <div id="web-llm-settings" class="ai-service-config">
                            <h5>Browser-based AI Model</h5>
                            <div class="form-group">
                                <label for="web-llm-model">Model</label>
                                <select id="web-llm-model">
                                    <option value="phi-2">Phi-2 (Small, Fast)</option>
                                    <option value="gemma-2b">Gemma 2B (Balanced)</option>
                                    <option value="llama-7b">Llama 7B (Large, Accurate)</option>
                                </select>
                            </div>
                            <div class="model-info">
                                <p>Model will be downloaded and run in your browser. No data sent to external servers.</p>
                                <div id="model-status" class="status-indicator">
                                    <span class="status-dot"></span>
                                    <span class="status-text">Not loaded</span>
                                </div>
                            </div>
                        </div>

                        <!-- API Settings -->
                        <div id="api-settings" class="ai-service-config hidden">
                            <div class="form-group">
                                <label for="api-key">API Key</label>
                                <input type="password" id="api-key" placeholder="Your API key">
                            </div>
                            <div class="form-group">
                                <label for="api-model">Model</label>
                                <select id="api-model">
                                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                    <option value="gpt-4">GPT-4</option>
                                    <option value="claude-3-haiku">Claude 3 Haiku</option>
                                </select>
                            </div>
                        </div>

                        <!-- Test AI Button -->
                        <button id="test-ai" class="btn btn-secondary">Test AI Configuration</button>
                    </div>
                </div>

                <!-- Preview Tab -->
                <div id="preview-tab" class="tab-content">
                    <div class="preview-section">
                        <div class="preview-controls">
                            <button id="generate-preview" class="btn btn-primary">Generate Preview</button>
                            <button id="download-sample" class="btn btn-secondary">Download Sample</button>
                        </div>
                        <div id="preview-container" class="preview-container">
                            <div class="preview-placeholder">
                                <i class="icon-preview"></i>
                                <p>Generate a preview to see how your EPUB will look</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Conversion Progress -->
            <section id="conversion-progress" class="conversion-progress hidden">
                <div class="progress-header">
                    <h3>Converting Document</h3>
                    <div class="progress-stats">
                        <span id="progress-percentage">0%</span>
                        <span id="progress-status">Initializing...</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <div class="progress-details">
                    <div id="progress-log" class="progress-log"></div>
                </div>
            </section>

            <!-- Conversion Actions -->
            <section class="conversion-actions">
                <button id="convert-btn" class="btn btn-primary btn-large" disabled>
                    <i class="icon-convert"></i>
                    Convert to EPUB
                </button>
                <button id="download-btn" class="btn btn-success btn-large hidden">
                    <i class="icon-download"></i>
                    Download EPUB
                </button>
            </section>
        </main>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="settings-section">
                        <h3>Application Settings</h3>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="auto-save-settings">
                                Auto-save settings
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="show-advanced-options">
                                Show advanced options
                            </label>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h3>Theme</h3>
                        <div class="form-group">
                            <label for="ui-theme">Interface Theme</label>
                            <select id="ui-theme">
                                <option value="light">Light</option>
                                <option value="dark">Dark</option>
                                <option value="auto">System</option>
                            </select>
                        </div>
                    </div>
                    <div class="settings-actions">
                        <button id="export-settings" class="btn btn-secondary">Export Settings</button>
                        <button id="import-settings" class="btn btn-secondary">Import Settings</button>
                        <button id="reset-settings" class="btn btn-danger">Reset to Defaults</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-content">
                <p>&copy; 2024 Docx2Shelf Contributors |
                   <a href="https://github.com/LightWraith8268/Docx2Shelf">GitHub</a> |
                   <a href="#" id="about-link">About</a>
                </p>
                <div class="build-info">
                    <span>Web Version | Build: <span id="build-version">1.6.2-web</span></span>
                </div>
            </div>
        </footer>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/app.js" type="module"></script>
    <script src="js/file-handler.js" type="module"></script>
    <script src="js/epub-generator.js" type="module"></script>
    <script src="js/settings-manager.js" type="module"></script>
    <script src="js/ui-manager.js" type="module"></script>
</body>
</html>